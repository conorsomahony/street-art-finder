<!--
* Author: Conor O'Mahony
* Assignment: FDWM2 Assessment 1 - Street Art Finder
* Student ID: STU-00001490
* Date: 2018/02/26 

# REFERENCES:
## Development folder setup (including Bootstrap, SASS and CSS setup)
* https://www.youtube.com/watch?v=Mu74UmFBAq8&t=3s

## Bootstrap 4
* https://coursetro.com/posts/code/130/Learn-Bootstrap-4-Final-in-2018-with-our-Free-Crash-Course
* https://getbootstrap.com/docs/4.0/getting-started/introduction/

## Bootstrap Carousel
* http://ryanringler.com/blog/2014/08/24/fixed-height-carousel-for-twitter-bootstrap

## jQuery
* https://www.youtube.com/playlist?list=PLillGF-RfqbYJVXBgZ_nA7FTAAEpp_IAc

## localForage (Wrapper for local storage and IndexedDB)
* https://localforage.github.io/localForage/

## Google Maps API
* https://developers.google.com/maps/documentation/javascript/examples/geocoding-reverse

## Fonts
* https://fontawesome.com/
* https://fonts.google.com/specimen/Roboto
* https://www.graphicpear.com/humger-free-font/
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Street Art Finder!</title>

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.6/css/all.css">

    <!-- I don't include html5shiv or respond.js here, as bootstrap 4 does not support IE9 or before
    https://stackoverflow.com/questions/48246476/does-bootstrap-4-need-html5shiv -->

    <!-- Bootstrap 4 imported into main.sass and compiled into main.css -->
    <!-- <link rel="stylesheet" href="./css/bootstrap.css"> -->
    <link rel="stylesheet" href="./css/main.css">
</head>

<body>
    <!-- header -->
    <header>
        <!-- nav -->
        <nav class="navbar navbar-expand-sm navbar-dark bg-dark" role="navigation">
            <div class="grow">
                <a class="navbar-brand" href="#">
                    <img src="./img/streetart-logo_orig_trans.png" class="cons-nav-logo" alt="Street Art Logo">
                </a>
            </div>
            <!-- toggle -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive"
                aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars fa-2x"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item ml-auto order-1 order-sm-2 px-2">
                        <img id="userimage" class="cons-user-img" style="height:2.5em" src="./img/fa_user.png" alt="">
                    </li>
                    <li class="nav-item ml-auto order-2 order-sm-1">
                        <a id="username" class="nav-link text-info disabled" href="#">(Not Signed In)</a>
                    </li>
                    <li class="nav-item ml-auto order-3">
                        <a id="sign-in-out" class="nav-link" href="#"> Sign In</a>
                    </li>
                    <!-- <li class="nav-item ml-auto order-4">
                        <a class="nav-link" href="#">Register</a>
                    </li> -->
                </ul>
            </div>
        </nav>
        <!-- end-of nav -->
    </header>
    <!-- end-of header -->

    <!-- main -->
    <main role="main">
        <!--"CAROUSEL" section -->
        <section>
            <div class="container-fluid bg-dark cons-wall-background pb-2">
                <div class="row">
                    <div class="col-12">
                        <div id="myCarousel" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                                <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                                <li data-target="#myCarousel" data-slide-to="1"></li>
                                <li data-target="#myCarousel" data-slide-to="2"></li>
                            </ol>
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img id="carousel-item-1-img" class="d-block w-100 img-fluid" src="./img/streetart_1.jpg" alt="First slide">
                                    <div class="carousel-caption d-none d-sm-block cons-carousel-caption">
                                        <h5 class="cons-display-font">Cool Vista</h5>
                                        <p class="d-none d-md-block">I hear the jury's still out on science. It's called 'taking advantage.' It's what
                                            gets you ahead in life. Get me a vodka rocks. And a piece of toast. Whoa, this
                                            guy's straight? We just call it a sausage.</p>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <img id="carousel-item-2-img" class="d-block w-100 img-fluid" src="./img/streetart_2.jpg" alt="Second slide">
                                    <div class="carousel-caption d-none d-sm-block cons-carousel-caption">
                                        <h5 class="cons-display-font">Political Satire</h5>
                                        <p class="d-none d-md-block">Get me a vodka rocks. And a piece of toast. That's why you always leave a note! It's
                                            called 'taking advantage.' It's what gets you ahead in life. As you may or may
                                            not know, Lindsay and I have hit a bit of a rough patch.</p>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <img id="carousel-item-3-img" class="d-block w-100 img-fluid" src="./img/streetart_3.jpg" alt="Third slide">
                                    <div class="carousel-caption d-none d-sm-block cons-carousel-caption">
                                        <h5 class="cons-display-font">Buenos Aires Bunny</h5>
                                        <p class="d-none d-md-block">We just call it a sausage. It's called 'taking advantage.' It's what gets you ahead
                                            in life. That's what it said on 'Ask Jeeves.' There's so many poorly chosen words
                                            in that sentence.</p>
                                    </div>
                                </div>
                            </div>
                            <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end-of "CAROUSEL" section -->

        <!--"HOW TO" section -->
        <section>
            <!--"TOP LEVEL DARK" .container -->
            <div class="container-fluid text-light my-0 px-3 pb-2 bg-dark cons-wall-background">
                <div class="row">
                    <div class="col text-center my-5">
                        <h1 class="cons-display-font">How to use StreetArt Finder</h1>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4 text-center">
                        <span class="fa-stack fa-3x">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <strong class="fa-stack-1x text-light">1</strong>
                        </span>
                        <h3 class="text-info cons-display-font my-3">Take a photo</h3>
                        <p>Take a photo with your phone</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <span class="fa-stack fa-3x">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <strong class="fa-stack-1x text-light">2</strong>
                        </span>
                        <h3 class="text-info cons-display-font my-3">Upload it</h3>
                        <p>Upload it to StreetArt Finder</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <span class="fa-stack fa-3x">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <strong class="fa-stack-1x text-light">3</strong>
                        </span>
                        <h3 class="text-info cons-display-font my-3">Tag it</h3>
                        <p>Tag it so everyone can find it</p>
                    </div>
                </div>
            </div>
            <!-- end-of "TOP LEVEL DARK" .container -->
        </section>
        <!-- end-of "HOW TO" section -->

        <!-- "ALBUM" section-->
        <section>
            <!--"TOP LEVEL DARK" .container -->
            <div class="container-fluid text-light bg-dark cons-wall-background">
                <div class="row">
                    <div class="col text-center my-5">
                        <h1 class="cons-display-font">Latest Uploads</h1>
                    </div>
                </div>
                <div class="container-fluid text-dark">
                    <div class="row">
                        <!-- .card -->
                        <div id="col-card-1" class="col-lg-6 mb-4 order-1">
                            <div class="card h-100">
                                <img class="card-img-top" src="./img/streetart_1.jpg" alt="Card image cap">
                                <div class="card-img-overlay">
                                    <button type="button" class="btn btn-primary border" data-toggle="modal" data-target="#exampleModal" data-image-title="Cool Vista">Share&NonBreakingSpace;
                                        <i class="fas fa-share-alt" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h4 class="card-title">Cool Vista</h4>
                                    <p class="card-text">
                                        <span class="badge badge-secondary">Dublin, Ireland</span>
                                        <span class="badge badge-info">#Coffee #Ideas</span>
                                    </p>
                                    <p class="card-text">I hear the jury's still out on science. It's called 'taking advantage.' It's what gets
                                        you ahead in life. Get me a vodka rocks. And a piece of toast. Whoa, this guy's straight?
                                        We just call it a sausage.</p>
                                </div>
                                <div class="card-footer text-right">
                                    <p class="card-text">
                                        <small class="text-muted">Uploaded: Sun, 04 Mar 2018 13:33:28 GMT</small>
                                    </p>
                                </div>
                            </div>
                            <!-- end-of .card -->
                        </div>
                        <div id="col-card-2" class="col-lg-6 mb-4 order-2">
                            <!-- .card -->
                            <div class="card h-100">
                                <img class="card-img-top" src="./img/streetart_2.jpg" alt="Card image cap">
                                <div class="card-img-overlay">
                                    <button type="button" class="btn btn-primary border" data-toggle="modal" data-target="#exampleModal" data-image-title="Political Satire">Share&NonBreakingSpace;
                                        <i class="fa fa-share-alt" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h4 class="card-title">Political Satire</h4>
                                    <p class="card-text">
                                        <span class="badge badge-secondary">Cork, Ireland</span>
                                        <span class="badge badge-info">#Lovers #Kiss</span>
                                    </p>
                                    <p class="card-text">Get me a vodka rocks. And a piece of toast. That's why you always leave a note! It's
                                        called 'taking advantage.' It's what gets you ahead in life. As you may or may not
                                        know, Lindsay and I have hit a bit of a rough patch.
                                    </p>
                                </div>
                                <div class="card-footer text-right">
                                    <p class="card-text">
                                        <small class="text-muted">Uploaded: Sun, 04 Mar 2018 13:33:28 GMT</small>
                                    </p>
                                </div>
                            </div>
                            <!-- end-of .card -->
                        </div>
                        <div id="col-card-3" class="col-lg-6 mb-4 order-3">
                            <!-- .card -->
                            <div class="card h-100">
                                <img class="card-img-top" src="./img/streetart_3.jpg" alt="Card image cap">
                                <div class="card-img-overlay">
                                    <button type="button" class="btn btn-primary border" data-toggle="modal" data-target="#exampleModal" data-image-title="Buenos Aires Bunny">Share&NonBreakingSpace;
                                        <i class="fa fa-share-alt" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h4 class="card-title">Buenos Aires Bunny</h4>
                                    <p class="card-text">
                                        <span class="badge badge-secondary">Buenos Aires, Argentina</span>
                                        <span class="badge badge-info">#Bicycle #Sunny</span>
                                    </p>
                                    <p class="card-text">We just call it a sausage. It's called 'taking advantage.' It's what gets you ahead in
                                        life. That's what it said on 'Ask Jeeves.' There's so many poorly chosen words in
                                        that sentence.</p>
                                </div>
                                <div class="card-footer text-right">
                                    <p class="card-text">
                                        <small class="text-muted">Uploaded: Sun, 04 Mar 2018 13:33:28 GMT</small>
                                    </p>
                                </div>
                            </div>
                            <!-- end-of .card -->
                        </div>
                        <div class="col-lg-6 mb-4 order-4">
                            <!-- .card -->
                            <div class="card h-100">
                                <img class="card-img-top" src="./img/streetart_4.jpg" alt="Card image cap">
                                <div class="card-img-overlay">
                                    <button type="button" class="btn btn-primary border" data-toggle="modal" data-target="#exampleModal" data-image-title="Madrid Master">Share&NonBreakingSpace;
                                        <i class="fa fa-share-alt" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h4 class="card-title">Madrid Master</h4>
                                    <p class="card-text">
                                        <span class="badge badge-secondary">Madrid, Spain</span>
                                        <span class="badge badge-info">#Building #Colours</span>
                                    </p>
                                    <p class="card-text">I'm a monster. I don't understand the question, and I won't respond to it. As you may
                                        or may not know, Lindsay and I have hit a bit of a rough patch. There's only one
                                        man I've ever called a coward, and that's Brian Doyle Murray.</p>
                                </div>
                                <div class="card-footer text-right">
                                    <p class="card-text">
                                        <small class="text-muted">Uploaded: Sun, 04 Mar 2018 13:33:28 GMT</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- end-of .card -->
                    </div>
                </div>
            </div>
            <!-- end-of "TOP LEVEL DARK" .container -->
        </section>
        <!-- end-of "ALBUM" section -->

        <!-- "UPLOAD" section -->
        <section>
            <!-- "TOP LEVEL LIGHT" .container -->
            <div class="container-fluid text-dark bg-light">
                <!--"UPLOAD" -->
                <div class="row">
                    <div class="col text-center">
                        <div class="my-4">
                            <h3>Upload</h3>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!--"UPLOAD INFO" -->
                    <div class="col-md-6 order-2 order-md-1">
                        <div class="card bg-info text-light mb-4">
                            <div class="card-body">
                                <h4 class="card-title">How to Upload</h4>
                                <p class="card-text">
                                    But anyhoo, can you believe that the only reason the club is going under is because it's in a terrifying neighborhood? I
                                    see you've wasted no time in filling my seat hole. I've been in the film business for
                                    a while but I just cant seem to get one in the can. God knows they're squinters. That's
                                    how Tony Wonder lost a nut. And the soup of the day is bread. I've always been deeply
                                    passionate about nature. Perhaps you remember Neuterfest?
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- end-of "UPLOAD INFO" -->

                    <!--"UPLOAD" form -->
                    <div class="col-md-6 order-1 order-md-2">
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="card-title d-none d-md-block h4 text-center">
                                    Upload here
                                </div>
                                <form id="uploadForm">
                                    <div class="form-group">
                                        <label for="photo-name">Photo Name</label>
                                        <input type="text" class="form-control" id="photo-name" placeholder="Photo Name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="photo-hashtag">Hashtag</label>
                                        <input type="text" class="form-control" id="photo-hashtag" placeholder="#" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="photo-description">Description</label>
                                        <textarea class="form-control" id="photo-description" rows="3" placeholder="Description" required maxlength="280"></textarea>
                                    </div>
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="photo-file" accept="image/*" required>
                                        <label class="custom-file-label" for="photo-file" id="choose-file-label">Choose file</label>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary btn-lg text-light mt-3 w-100">Upload</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- end-of "UPLOAD" form -->
                </div>
            </div>
            <!-- end-of "TOP LEVEL LIGHT" -->
        </section>
        <!-- end-of "UPLOAD" section -->

    </main>
    <!-- end-of main -->


    <!-- footer -->
    <footer class="text-center text-light bg-dark">
        <div>
            Copyright &copy; 2018 Street Art Finder
        </div>
        <div>
            <img src="./img/streetart-logo_orig_trans.png" class="cons-footer-logo" alt="Street Art Logo">
        </div>
    </footer>
    <!-- end-of footer -->

    <!-- ADDITIONAL HTML content -->
    <!--"MODAL SHARE DIALOG" -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-light">
                    <h4 class="modal-title" id="exampleModalLabel">Temporary text</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="text-light" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Temporary text2
                </div>
                <div class="modal-footer">
                    <div>
                        <a class="btn btn-primary" href="https://www.facebook.com" target="_blank">
                            <i class="fab fa-facebook fa-2x text-light"></i>
                        </a>
                        <a class="btn btn-primary" href="https://www.twitter.com" target="_blank">
                            <i class="fab fa-twitter fa-2x text-light"></i>
                        </a>
                        <a class="btn btn-primary" href="https://www.instagram.com" target="_blank">
                            <i class="fab fa-instagram fa-2x text-light"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end-of "MODAL SHARE DIALOG" -->

    <!--"MODAL UPLOAD COMPLETE" -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-light">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Upload complete!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="text-light" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Your image has been uploaded to StreetArt Finder!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- end-of ADDITIONAL HTML content -->

    <!-- SCRIPTS -->
    <script src="./js/jquery.min.js"></script>
    <script src="./js/popper.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <!-- Investigate localForage for IndexedDB/localStorage access -->
    <script src="./js/localforage.min.js"></script>
    <script>
        getLocation();
        setInterval(getLocation, 10000);

        // Local Forage wrapper for IndexedDB
        var imagesStore = localforage.createInstance({
            name: "StreetArtImages"
        });
        var locationStore = localforage.createInstance({
            name: "StreetArtLocation"
        });

        const ALBUM_SIZE = 4;
        const CAROUSEL_SIZE = 3;

        /*
         * Get current location and store it in client-side storage (if location has changed)
         */
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    locationStore.getItem("lastLocation", function (err, lastLocation) {
                        var location = position.coords.latitude + "," + position.coords.longitude;
                        // console.log("lastLocation:" + lastLocation);
                        // console.log("location:" + location);
                        if (lastLocation != location) {
                            locationStore.setItem("lastLocation", location);
                            doReverseLookup(location);
                        }
                    });
                });
            } else {
                console.warn("location not found");
            }
        }

        /*
         * Given a location, perform a geocoder reverse lookup to store name of location
         */
        function doReverseLookup(location) {
            var split = location.split(",");
            var latlng = {
                lat: parseFloat(split[0]),
                lng: parseFloat(split[1])
            };
            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({
                'location': latlng
            }, function (results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        // store formatted address
                        locationStore.setItem("locationText", results[0].formatted_address)
                        // store shorter address information
                        var res, locality, country = '';
                        var components = results[0].address_components;
                        for (var component = 0; component < (components.length); component++) {
                            if (components[component].types[0] == "locality") {
                                locality = components[component].long_name;
                            }
                            if (components[component].types[0] == "country") {
                                country = components[component].long_name;
                            }
                        }
                        res = locality + ', ' + country;
                        locationStore.setItem("shortLocationText", res);
                    } else {
                        console.warn('No results found');
                    }
                } else {
                    console.warn('Geocoder failed due to: ' + status);
                }
            });
        }

        // will only run once the page Document Object Model (DOM) is ready for JavaScript code to execute
        $(document).ready(function () {

            // Simple mockup of sign in and sign out
            $('#sign-in-out').click(function (event) {
                // console.log(event);
                var text = this.text;
                if (text == " Sign In") {
                    this.text = "Sign Out";
                    $('#username').text("comahony");
                    $('#userimage').attr('src', "./img/X_user.jpg");
                } else {
                    this.text = " Sign In"
                    $('#username').text("(Not Signed In)");
                    $('#userimage').attr('src', "./img/fa_user.png");
                }
            })

            /*
             * Event handler for showing modal dialog for "Share" buttons.
             */
            $('#exampleModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget) // Button that triggered the modal
                var imageTitle = button.data('image-title') // Extract info from data-* attributes
                // Update the modal's content.
                var modal = $(this)
                modal.find('.modal-title').text('Share "' + imageTitle + '"')
                // get current location from local storage
                locationStore.getItem('shortLocationText').then(function (value) {
                    var message = value == null ? 'Found this picture using StreetArt Finder!' :
                        'Found this in ' + value +
                        ' with StreetArt Finder!';
                    modal.find('.modal-body').text(message);
                });
            });


            /*
             * Event handler for upload form submit event.
             *
             * Prevent the form being submitted and handle it locally
             * Mimic a file upload and store the data locally, adding the image to the carousel and album via jQuery
             */
            $('#uploadForm').on('submit', function (event) {
                event.preventDefault();
                var photoName = $('#photo-name').val();
                var photoDescription = $('#photo-description').val();
                var photoHashtag = $('#photo-hashtag').val();
                var photoFile = $('#photo-file')[0].files[0];
                var reader = new FileReader();
                reader.readAsDataURL(photoFile);
                reader.onload = function () {
                    locationStore.getItem('shortLocationText').then(function (location) {
                        var date = new Date();
                        var uploadedPhoto = {
                            name: photoName,
                            description: photoDescription,
                            hashtag: photoHashtag,
                            location: location,
                            date: date.toUTCString(),
                            dataURL: reader.result
                        };
                        // store data in IndexedDB 
                        // (we don't necessarily use this for anything now, but could load stored images on page load,
                        // rather than the defaults)
                        imagesStore.setItem(photoName, uploadedPhoto, function (err, result) {
                            updateCarousel(uploadedPhoto);
                            updateAlbum(uploadedPhoto);
                            $('#exampleModalCenter').modal('show');
                        });
                    });
                };
            });

            /*
             * Event handler for file input.
             *
             * display selected file in the form
             */
            $(function () {
                $("input:file").change(function () {
                    var fileName = $(this).val();
                    $("#choose-file-label").html(fileName);
                });
            });

            carouselNormalization();
        });

        /* 
         * Given the new uploaded photo, add it to the start of the carousel, and shove on the other ones.
         */
        function updateCarousel(uploadedPhoto) {
            // shove on all the other photos first
            for (var i = CAROUSEL_SIZE; i > 1; i--) {
                var image = $('#carousel-item-' + i + '-img');
                var prevImage = $('#carousel-item-' + (i - 1) + '-img');
                image.attr('src', prevImage.attr('src'));
                image.next().find('h5').text(prevImage.next().find('h5').text());
                image.next().find('p').text(prevImage.next().find('p').text());
            }
            // put the new photo in the first carousel item
            $('#carousel-item-1-img').attr('src', uploadedPhoto.dataURL);
            $('#carousel-item-1-img').next().find('h5').text(uploadedPhoto.name);
            $('#carousel-item-1-img').next().find('p').text(uploadedPhoto.description);
        }

        /*
         * Given the new uploaded photo, update the album with the new photo and data.
         */
        function updateAlbum(uploadedPhoto) {
            updateLastCard(uploadedPhoto);
            reorderCards();
        }

        /*
         * Given the new uploaded photo, replace the photo and data in the last (oldest) card with the new photo and data.
         */
        function updateLastCard(uploadedPhoto) {
            var lastCard = $('div.order-4 div.card');
            lastCard.find("img").attr('src', uploadedPhoto.dataURL);
            lastCard.find(".card-title").text(uploadedPhoto.name);
            lastCard.find(".badge-secondary").text(uploadedPhoto.location);
            lastCard.find(".badge-info").text(uploadedPhoto.hashtag);
            lastCard.find(".card-body p.card-text:nth-of-type(2)").text(uploadedPhoto.description);
            lastCard.find(".card-footer .text-muted").text("Uploaded:" + uploadedPhoto.date);
            lastCard.find(".card-img-overlay button").attr("data-image-title", uploadedPhoto.name);
        }

        /*
         * Re-order our album cards with the new uploaded photo first.
         *
         * Take advantage of bootstrap and flex "order-x" classes to do this.
         * (Note: this probably won't work if our displayed album is bigger than 12, but we are assuming 4 cards)
         * see - https://getbootstrap.com/docs/4.0/utilities/flex/
         */
        function reorderCards() {
            $('.order-' + ALBUM_SIZE).removeClass('order-' + ALBUM_SIZE).addClass('order-temp');
            for (var i = ALBUM_SIZE - 1; i > 0; i--) {
                $('.order-' + i).removeClass('order-' + i).addClass('order-' + (i + 1));
            }
            $('.order-temp').removeClass('order-temp').addClass('order-1');
        }

        /* 
         * Normalises the image heights in the carousel.
         *
         * Code reuse
         * Ref: http://ryanringler.com/blog/2014/08/24/fixed-height-carousel-for-twitter-bootstrap
         */
        function carouselNormalization() {
            var items = $('#myCarousel .carousel-item'), // grab all the slides
                heights = [], // array to store heights
                tallest, shortest; // tallest slide

            if (items.length) {
                function normalizeHeights() {
                    items.each(function () {
                        heights.push($(this).height()); // add each slide's height
                    }); // to the array

                    tallest = Math.max.apply(null, heights); // find the largest height
                    items.each(function () {
                        $(this).css('min-height', tallest + 'px'); // set each slide's minimum
                    }); // height to the largest
                };

                normalizeHeights();

                $(window).on('resize orientationchange', function () {
                    tallest = 0, smallest = 0, heights.length = 0; // reset the variables
                    items.each(function () {
                        $(this).css('min-height', '0'); // reset each slide's height
                    });
                    normalizeHeights(); // run it again
                });
            }
        }
    </script>

    <!-- For Reverse Geocoding lookup -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiBf9WrNYKOB-klGNa_HRZRfqu1hSh_Bw">
    </script>
</body>

</html>